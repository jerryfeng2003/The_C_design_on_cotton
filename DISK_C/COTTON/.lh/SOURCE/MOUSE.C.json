{
    "sourceFile": "SOURCE/MOUSE.C",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1681364724278,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1681364724278,
            "name": "Commit-0",
            "content": "#include<conio.h>\r\n#include<graphics.h>\r\n#include<dos.h>\r\n#include<stdio.h>\r\n#include<stdlib.h>\r\n#include \"mouse.h\"\r\n\r\n\r\n/**************************\r\nMOUSE.c\r\nUPDATER: dengshuumin\r\nFUNCTION: mouse action\r\nABSTRACT:\r\n\t\tA.mread\r\n\t\tB.newmouse\r\nVERSION: 3.0\r\n***************************/\r\nint MouseX;\r\nint MouseY;\r\nint MouseS;\r\nint press;\r\nvoid *buffer;\r\nunion REGS regs;\r\nint flag=0;\r\n\r\n\r\n\r\nvoid mouseinit()//閿熸枻鎷峰閿熸枻鎷?\r\n{\r\n\tint retcode;\r\n\tint xmin,xmax,ymin,ymax,x_max=625,y_max=480;\r\n\tint size;\r\n\r\n\txmin=2;\r\n\txmax=x_max-1;\r\n\tymin=8;\r\n\tymax=y_max-2;\r\n\tregs.x.ax=0;\r\n\tint86(51,&regs,&regs);\r\n\tretcode=regs.x.ax;\r\n\tif(retcode==0)\r\n\t{\r\n\t\tprintf(\"Mouse or Mouse Driver Obsent,Please Install!\");\r\n\t\tdelay(5000);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tregs.x.ax=7;\r\n\t\tregs.x.cx=xmin;\r\n\t\tregs.x.dx=xmax;\r\n\t\tint86(51,&regs,&regs);\r\n\t\tregs.x.ax=8;\r\n\t\tregs.x.cx=ymin;\r\n\t\tregs.x.dx=ymax;\r\n\t\tint86(51,&regs,&regs);\r\n\t}\r\n\tMouseS = 0;\r\n\tMouseX=320,MouseY=240;\r\n\tsave_bk_mou(320,240);\r\n\tmouse(MouseX,MouseY);\r\n\tflag=1;\r\n}\r\n\r\n/*****************************\r\nFUNCTION: mouse\r\nDESCRIPTION: 閿熸枻鎷烽敓鏂ゆ嫹鍚岄敓鏂ゆ嫹鎬侀敓鏂ゆ嫹閿熸枻鎷烽敓?\r\nINPUT: x,y\r\nRETURN: 閿熸枻鎷?\r\n******************************/\r\nvoid mouse(int x,int y)\r\n{\r\n\t\r\n\tswitch(MouseS)\r\n\t{\r\n\t\tcase 1:                                  //閿熸枻鎷烽敓鏂ゆ嫹閿熸枻鎷烽敓?\r\n\t\t{\r\n\t\t\t\tsetcolor(WHITE);\r\n\t\t\t\tsetlinestyle(0,0,1);\r\n\t\t\t\tline(x-1,y+9,x-1,y+8);\r\n\t\t\t\tline(x,y+7,x,y+11);\r\n\t\t\t\tline(x+1,y+6,x+1,y+13);\r\n\t\t\t\tline(x+2,y+8,x+2,y+14);\r\n\t\t\t\tline(x+3,y-1,x+3,y+15);\r\n\t\t\t\tarc(x+4,y-1,0,180,1);\r\n\t\t\t\tline(x+4,y-2,x+4,y+15);\r\n\t\t\t\tline(x+5,y-1,x+5,y+16);\r\n\t\t\t\tarc(x+6,y+3,0,180,1);\r\n\t\t\t\tline(x+6,y+2,x+6,y+16);\r\n\t\t\t\tline(x+7,y+3,x+7,y+17);\r\n\t\t\t\tarc(x+8,y+5,0,180,1);\r\n\t\t\t\tline(x+8,y+4,x+8,y+17);\r\n\t\t\t\tline(x+9,y+5,x+9,y+16);\r\n\t\t\t\tarc(x+10,y+7,0,180,1);\r\n\t\t\t\tline(x+10,y+6,x+10,y+16);\r\n\t\t\t\tline(x+11,y+7,x+11,y+13);\r\n\r\n\t\t\t\tsetcolor(DARKGRAY);\r\n\t\t\t\tline(x-1,y+9,x-1,y+8);\r\n\t\t\t\tline(x-1,y+8,x+1,y+6);\r\n\t\t\t\tline(x+1,y+6,x+3,y+10);\r\n\t\t\t\tline(x+3,y+10,x+3,y-1);\r\n\t\t\t\tarc(x+4,y-1,0,180,1);\r\n\t\t\t\tline(x+5,y-1,x+5,y+5);\r\n\t\t\t\tarc(x+6,y+3,0,180,1);\r\n\t\t\t\tline(x+7,y+3,x+7,y+7);\r\n\t\t\t\tarc(x+8,y+5,0,180,1);\r\n\t\t\t\tline(x+9,y+5,x+9,y+9);\r\n\t\t\t\tarc(x+10,y+7,0,180,1);\r\n\t\t\t\tline(x+11,y+7,x+11,y+13);\r\n\t\t\t\tarc(x+7,y+13,-90,0,4);\r\n\t\t\t\tline(x+7,y+17,x+3,y+15);\r\n\t\t\t\tline(x+3,y+15,x+1,y+13);\r\n\t\t\t\tline(x+1,y+13,x-1,y+9);\r\n\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 2:                        //閿熸枻鎷烽敓?\r\n\t\t{\r\n\t\t\tsetcolor(DARKGRAY);\r\n\t\t\tsetlinestyle(0,0,1);\r\n\t\t\tline(x+1,y-1,x+9,y-1);\r\n\t\t\tline(x+1,y+15,x+9,y+15);\r\n\t\t\tline(x+5,y-1,x+5,y+15);\r\n\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 3:                        //鍗侀敓鏂ゆ嫹\r\n\t\t{\r\n\t\t\tsetcolor(WHITE);\r\n\t\t\tsetlinestyle(0,0,1);\r\n\t\t\tline(x-1,y+7,x+11,y+7);\r\n\t\t\tline(x+5,y-1,x+5,y+15);\r\n\t\t}\r\n\t\t\tbreak;\r\n\t\tdefault:              //榛橀敓鏂ゆ嫹閿熸枻鎷烽敓?\r\n\t\t{\r\n\t\t\tsetlinestyle(0,0,1);\r\n\t\t\tsetcolor(WHITE);\r\n\t\t\tline(x,y,x,y+13);\r\n\t\t\tline(x+1,y+1,x+1,y+12);\r\n\t\t\tline(x+2,y+2,x+2,y+11);\r\n\t\t\tline(x+3,y+3,x+3,y+10);\r\n\t\t\tline(x+4,y+4,x+4,y+12);\r\n\t\t\tline(x+5,y+5,x+5,y+9);\r\n\t\t\tline(x+5,y+11,x+5,y+14);\r\n\t\t\tline(x+6,y+6,x+6,y+9);\r\n\t\t\tline(x+6,y+13,x+6,y+15);\r\n\t\t\tline(x+7,y+7,x+7,y+9);\r\n\t\t\tline(x+8,y+8,x+8,y+9);\r\n\t\t\tline(x+9,y+9,x+9,y+9);\r\n\t\t\tsetcolor(DARKGRAY);\r\n\t\t\tline(x-1,y-1,x-1,y+14);\r\n\t\t\tline(x-1,y+14,x+3,y+11);\r\n\t\t\tline(x+3,y+11,x+3,y+12);\r\n\t\t\tline(x+3,y+12,x+4,y+13);\r\n\t\t\tline(x+4,y+13,x+4,y+14);\r\n\t\t\tline(x+4,y+14,x+7,y+17);\r\n\t\t\tline(x+7,y+17,x+7,y+13);\r\n\t\t\tline(x+7,y+13,x+6,y+12);\r\n\t\t\tline(x+6,y+12,x+6,y+11);\r\n\t\t\tline(x+6,y+11,x+5,y+10);\r\n\t\t\tline(x+5,y+10,x+11,y+10);\r\n\t\t\tline(x+11,y+10,x-1,y-2);\r\n\t\t}\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\n/*void mou_pos(int *nx,int *ny,int*nbuttons)//閿熸枻鎷烽敓鏂ゆ嫹閿熸枻鎷烽敓杞夸紮鎷烽敓?\r\n{\r\n\tint x0=*nx,y0=*ny;\r\n\r\n\tmread(nx,ny,nbuttons);\r\n\tclrmous(x0,y0);\r\n\tsave_bk_mou(*nx,*ny);\r\n\tdrawmous(*nx,*ny);\r\n}\r\n\r\nvoid mread(int *nx,int *ny,int*nbuttons)//閿熸枻鎷烽敓鏂ゆ嫹閿熺枼涓嶉敓鏂ゆ嫹\r\n{\r\n\tint x0=*nx,y0=*ny,buttons0=*nbuttons;\r\n\tint xnew,ynew,buttonsnew;\r\n\r\n\tdo{\r\n\tregs.x.ax=3;\r\n\tint86(51,&regs,&regs);\r\n\tbuttonsnew=regs.x.bx;\r\n\tdelay(10);\r\n\tregs.x.ax=3;\r\n\tint86(51,&regs,&regs);\r\n\tif(regs.x.bx==buttonsnew)\r\n\t\t*nbuttons=regs.x.bx;\r\n\telse\r\n\t\t*nbuttons=buttons0;\r\n\txnew=regs.x.cx;\r\n\tynew=regs.x.dx;\r\n\t}while(xnew==x0&&ynew==y0&&*nbuttons==0);\r\n\t*nx=xnew;\r\n\t*ny=ynew;\r\n}\r\n*/\r\n\r\n/***************************************\r\nFUNCTION: mread\r\nDESCRIPTION: 閿熸枻鎷峰彇閿熼摪鐨勫瘎杈炬嫹閿熸枻鎷烽敓鏂ゆ嫹鎭?\r\nINPUT: nx,ny,nbuttons\r\nRETURN: 閿熸枻鎷?\r\n****************************************/\r\nvoid mread(int *nx,int *ny,int *nbuttons)  \r\n{\r\n\tregs.x.ax=3;\r\n\tint86(51,&regs,&regs);\r\n\t*nx = regs.x.cx;\r\n\t*ny = regs.x.dx;\r\n\t*nbuttons = regs.x.bx;\r\n}\r\n\r\n/*******************************************\r\nFUNCTION: newmouse\r\nDESCRIPTION: 閿熸枻鎷烽敓闃跺埡顒婃嫹閿熸枻鎷烽敓鏂ゆ嫹娴狀垽鎷烽敓鏂ゆ嫹閿熸枻鎷烽敓鏂ゆ嫹閿??\r\nINPUT: nx,ny,nbuttons\r\nRETURN: 閿熸枻鎷?\r\n********************************************/\r\nvoid newmouse(int *nx,int *ny,int *nbuttons)\r\n{\r\n\tint xn,yn,buttonsn;\r\n\tint x0=*nx,y0=*ny,buttons0=*nbuttons;\r\n\t// if(x0>615)\r\n\t// {\r\n\t// \tclrmous(x0,y0);\r\n\t// }\r\n\tmread(&xn,&yn,&buttonsn);\r\n\t*nx = xn;\r\n\t*ny = yn;\r\n\t*nbuttons = buttonsn;\r\n\tif(buttons0 == *nbuttons)\r\n\t\t*nbuttons = 0;    //浣块敓鏂ゆ嫹閿熸枻鎷烽敓鏂ゆ嫹閿熸枻鎷烽敓鏂ゆ嫹閿熸枻鎷?\r\n\tif(xn == x0 && yn == y0 && buttonsn == buttons0)\r\n\t\treturn;            //閿熸枻鎷烽敓闃跺埡顒婃嫹閿熸枻鎷烽敓鏂ゆ嫹閿熻鎲嬫嫹鑷冮敓鏂ゆ嫹閿熺祳\r\n\tclrmous(x0,y0);        //璇撮敓鏂ゆ嫹閿熸枻鎷烽敓闃跺埡顒婃嫹閿熸枻鎷烽敓鏂ゆ嫹鐑佽皨閿??\r\n\tsave_bk_mou(*nx,*ny);\r\n\tdrawmous(*nx,*ny);\r\n}\r\n\r\nvoid save_bk_mou(int nx,int ny)//閿熸枻鎷烽敓鏂ゆ嫹鐡鎷烽敓?\r\n{\r\n\tint size;\r\n\r\n\tsize=imagesize(nx-1,ny-2,nx+11,ny+17);\r\n\tbuffer=malloc(size);\r\n\tif(buffer!=NULL)\r\n\t\tgetimage(nx-1,ny-2,nx+11,ny+17,buffer);\r\n\telse\r\n\t\tprintf(\"Error\");\r\n}\r\n\r\nvoid clrmous(int nx,int ny)//閿熸枻鎷烽敓鏂ゆ嫹閿熸枻鎷?\r\n{\r\n\tif(flag==1)\r\n\t{\r\n\t\tsetwritemode(XOR_PUT); \r\n\t\tmouse(nx,ny);\r\n\t\tputimage(nx-1,ny-2,buffer,COPY_PUT);\r\n\t\tfree(buffer);\r\n\t\tflag=0;\r\n\t\tsetwritemode(COPY_PUT);\r\n\t}\r\n}\r\nvoid drawmous(int nx,int ny)\r\n{\r\n\tif(flag==0)\r\n\t{\r\n\t\tsetwritemode(COPY_PUT);\r\n\t    mouse(nx,ny);\r\n\t\tflag=1;\r\n\t}\r\n}\r\n\r\n\r\n\r\n//閿熸枻鎷烽敓鏂ゆ嫹璇抽敓鏂ゆ嫹姊伴敓鏂ゆ嫹閿熸枻鎷烽敓娲ヨ繑浼欐嫹1閿熸枻鎷烽敓鑺傚尅鎷烽敓鏂ゆ嫹鏈敓鏂ゆ嫹閿熸枻鎷烽敓鏂ゆ嫹铓嶇シ閿??2閿熸枻鎷烽敓鏂ゆ嫹閿熻妭鍖℃嫹閿熸枻鎷烽敓娲ヨ繑浼欐嫹0\r\nint mouse_press(int x1, int y1, int x2, int y2)\r\n{\r\n\t//閿熻妭鍖℃嫹閿熷彨纰夋嫹閿熸枻鎷烽敓鏂ゆ嫹铓嶇シ閿??1\r\n\tif(MouseX > x1 \r\n\t&&MouseX < x2\r\n\t&&MouseY > y1\r\n\t&&MouseY < y2\r\n\t&&press == 1)\r\n\t{\r\n\t\treturn 1;\r\n\t}\r\n\t\r\n\t//閿熻妭鍖℃嫹閿熸枻鎷锋湭閿熸枻鎷烽敓鏂ゆ嫹閿熸枻鎷疯殟绁烽敓?2\r\n\telse if(MouseX > x1 \r\n\t&&MouseX < x2\r\n\t&&MouseY > y1\r\n\t&&MouseY < y2\r\n\t&&press == 0)\r\n\t{\r\n\t\treturn 2;\r\n\t}\r\n\t\r\n\t//閿熻妭鍖℃嫹閿熷彨纰夋嫹閿熸枻鎷峰９閿熸枻鎷烽敓鏂ゆ嫹铓嶇シ閿??3\r\n\telse if(MouseX > x1 \r\n\t&&MouseX < x2\r\n\t&&MouseY > y1\r\n\t&&MouseY < y2\r\n\t&&press == 2)\r\n\t{\r\n\t\treturn 3;\r\n\t}\r\n\t\r\n\telse\r\n\t{\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\n"
        }
    ]
}